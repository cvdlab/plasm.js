!function(exports){var cos=Math.cos,sin=Math.sin,round=Math.round,min=Math.min,abs=Math.abs,pi=Math.PI,random=Math.random,floor=Math.floor,simplexn=exports.simplexn={};simplexn.version="0.1.5",simplexn._utils={};var _flat=simplexn._utils._flat=function(arrays){var res=[];return arrays.forEach(function(item){res=res.concat(item)}),res},_repeat=simplexn._utils._repeat=function(value,n){var res=[];while(n--)res.push(value);return res},_swap=simplexn._utils._swap=function(array,i1,i2){var tmp=array[i1];array[i1]=array[i2],array[i2]=tmp},_partition=simplexn._utils._partition=function(array,begin,end,pivot){var piv=array[pivot],store=begin,ix;_swap(array,pivot,end-1);for(ix=begin;ix<end-1;++ix)array[ix]<=piv&&(_swap(array,store,ix),++store);return _swap(array,end-1,store),store},_qsort=simplexn._utils._qsort=function(array,begin,end){if(end-1>begin){var pivot=begin+floor(random()*(end-begin));pivot=_partition(array,begin,end,pivot),_qsort(array,begin,pivot),_qsort(array,pivot+1,end)}},_quickSort=simplexn._utils._quickSort=function(array){_qsort(array,0,array.length)},_areEqual=simplexn._utils._areEqual=function(a1,a2){var a1Len=a1.length,a2Len=a2.length,i;if(a1Len!==a2Len)return!1;for(i=0;i<a1Len;i++)if(a1[i]!==a2[i])return!1;return!0};simplexn.vector={};var vectorAdd=simplexn.vector.add=function(v1,v2){var rn=v1.length,res=new v1.constructor(rn),i;for(var i=0;i<rn;i+=1)res[i]=v1[i]+v2[i];return res},vectorSub=simplexn.vector.sub=function(v1,v2){var rn=v1.length,res=new v1.constructor(rn),i;for(var i=0;i<rn;i+=1)res[i]=v1[i]-v2[i];return res},vectorMul=simplexn.vector.mul=function(v1,v2){var rn=v1.length,res=new v1.constructor(rn),i;for(var i=0;i<rn;i+=1)res[i]=v1[i]*(v2[i]||1);return res},vectorScalarMul=simplexn.vector.scalarMul=function(scalar,v){var rn=v.length,res=new v.constructor(rn),i;for(var i=0;i<rn;i+=1)res[i]=scalar*v[i];return res},vectorScalarDiv=simplexn.vector.scalarDiv=function(scalar,v){var rn=v.length,res=new v.constructor(rn),i;for(var i=0;i<rn;i+=1)res[i]=v[i]/scalar;return res},vectorAvg=simplexn.vector.avg=function(vectors){var vectors=vectors||[[]],length=vectors.length,rn=vectors[0].length,res=new vectors[0].constructor(rn),i;for(i=0;i<rn;i+=1)res[i]=0;return res=vectors.reduce(vectorAdd,res),res=vectorScalarDiv(length,res),res};simplexn.matrix={};var matrixIdentity=simplexn.matrix.identity=function(dim){var matrix=new Array(dim),i,j;for(i=0;i<dim;i+=1){matrix[i]=new Array(dim);for(j=0;j<dim;j+=1)matrix[i][j]=j===i?1:0}return matrix},PointSet=simplexn.PointSet=function(points,rn){points=points||[[]],typeof points=="number"?(this.rn=rn,points*=rn):(this.rn=points[0].length,points=_flat(points)),this.points=new Float32Array(points)};simplexn.PointSet.prototype.__defineGetter__("size",function(){return this.points.length/this.rn}),simplexn.PointSet.prototype.clone=function(){var clone=new PointSet;return clone.size=this.size,clone.rn=this.rn,clone.points=new Float32Array(this.points),clone},simplexn.PointSet.prototype.equals=function(other){if(this.rn!==other.rn||this.size!==other.size)return!1;for(var i=0,l=this.points.length;i<l;i+=1)if(this.points[i]!==other.points[i])return!1;return!0},simplexn.PointSet.prototype.get=function(index){var rn=this.rn,begin=index*rn,end=begin+rn;return this.points.subarray(begin,end)},simplexn.PointSet.prototype.set=function(point,index){return point=point||0,this.points.set(point,index*this.rn),this},simplexn.PointSet.prototype.forEach=function(iterator){var points=this.points,length=points.length,rn=this.rn,i,j;for(i=j=0;i<length;i+=rn,j+=1)iterator(points.subarray(i,i+rn),j);return this},simplexn.PointSet.prototype.map=function(mapping){var points=this.points,oldRn=this.rn,size=this.size,mappedPoints0=mapping(points.subarray(0,oldRn)),newRn=mappedPoints0.length,newPoints=new Float32Array(size*newRn),i,j;newPoints.set(mappedPoints0);for(i=oldRn,j=1;j<size;i+=oldRn,j+=1)newPoints.set(mapping(points.subarray(i,i+oldRn),j),j*newRn);return this.points=newPoints,this.rn=newRn,this},simplexn.PointSet.prototype.filter=function(iterator){var points=this.points,length=points.length,filtered=new Float32Array(length),rn=this.rn,i,j,k,point,pointset;for(i=j=k=0;i<length;i+=rn,j+=1)point=points.subarray(i,i+rn),iterator(point,j)&&(filtered.set(point,k),k+=rn);return filtered=filtered.subarray(0,k),pointset=new PointSet,pointset.points=filtered,pointset.rn=rn,pointset.size=k/rn,pointset},simplexn.PointSet.prototype.merge=function(precision){var precision=precision||1e-4,points=this.points,length=points.length,rn=this.rn,size=this.size,indices=new Uint32Array(size),merged=new Float32Array(length),usedIndices=0,usedCoords=0,vertexAdded,equals,i,j,k;for(i=0;i<length;i+=rn){vertexAdded=!1;for(j=0;j<usedCoords&&!vertexAdded;j+=rn){equals=!0;for(k=0;k<rn;k+=1)points[i+k]=round(points[i+k]/precision)*precision,equals&=points[i+k]===merged[j+k];vertexAdded|=equals}indices[i/rn]=vertexAdded?j/rn-1:usedIndices;if(!vertexAdded){for(k=0;k<rn;k+=1)merged[usedCoords+k]=points[i+k];usedIndices+=1,usedCoords=usedIndices*rn}}return this.points=merged.subarray(0,usedCoords),indices},simplexn.PointSet.prototype.rotate=function(dims,angle){var dims=dims[0]>dims[1]?[dims[1],dims[0]]:dims,points=this.points,length=points.length,rn=this.rn,cos_a=cos(angle),sin_a=sin(angle),r_ii=cos_a,r_ij=-sin_a,r_ji=sin_a,r_jj=cos_a,d_i=dims[0],d_j=dims[1],v_i,v_j,i,j,k;(dims[0]+dims[1])%2==0&&(r_ij*=-1,r_ji*=-1);for(k=0,i=d_i,j=d_j;k<length;k+=rn,i=k+d_i,j=k+d_j)v_i=points[i],v_j=points[j],points[i]=v_i*r_ii+v_j*r_ij,points[j]=v_i*r_ji+v_j*r_jj;return this},simplexn.PointSet.prototype.scale=function(dims,values){var points=this.points,length=points.length,dimsLength=dims.length,rn=this.rn,i,j;for(i=0;i<length;i+=rn)for(j=0;j<dimsLength;j+=1)points[i+dims[j]]*=values[j];return this},simplexn.PointSet.prototype.translate=function(dims,values){var rn=this.rn,maxDim=Math.max.apply(null,dims.concat(rn-1));this.embed(maxDim+1);var points=this.points,length=points.length,dimsLength=dims.length,i,j;for(i=0;i<length;i+=rn)for(j=0;j<dimsLength;j+=1)points[i+dims[j]]+=values[j];return this},simplexn.PointSet.prototype.transform=function(matrix){return this},simplexn.PointSet.prototype.embed=function(dim){var dim=dim||this.rn+1,rn=this.rn,minDim=Math.min(rn,dim),oldPoints=this.points,oldLength=oldPoints.length,length=oldLength/rn*dim,points=new Float32Array(length),i,j,k;for(i=0,j=0;i<oldLength;i+=rn,j+=dim)for(k=0;k<minDim;k+=1)points[j+k]=oldPoints[i+k];return this.points=points,this.rn=dim,this},simplexn.PointSet.prototype.prod=function(pointset){var size=this.size,rn=this.rn,pointsetSize=pointset.size,pointsetRn=pointset.rn,newSize=size*pointsetSize,newRn=rn+pointsetRn,newLength=newSize*newRn,newPoints=new Float32Array(newLength),newPoint,point1,point2,i,j,n=0;for(j=0;j<pointsetSize;j+=1){point2=pointset.get(j);for(i=0;i<size;i+=1)newPoint=new Float32Array(newRn),point1=this.get(i),newPoint.set(point1),newPoint.set(point2,rn),newPoints.set(newPoint,newRn*n++)}return this.points=newPoints,this.rn=newRn,this};var Topology=simplexn.Topology=function(complex,dim){this._computeTopology(complex,dim)};simplexn.Topology.prototype._computeTopology=function(complex,dim){var complex=complex||[[]],dim,complexes=new Array,complexTemp,complexNext,complexNextLength,complexLength,cellDim,d,c,i,j,k,exchange1,exchange2;complex=complex.length>0?complex:[[]],dim=dim||complex[0].length-1,complex=complex instanceof Array?_flat(complex):complex,dim>=0&&(complexes[0]=new Uint32Array);if(dim===0||dim>=1)complexes[dim]=new Uint32Array(complex);for(d=dim;d>1;d-=1){complexNext=complexes[d],complexNextLength=complexNext.length,cellDim=d+1,complexLength=complexNextLength/cellDim,complexTemp=new Uint32Array(cellDim*complexLength*d),complexes[d-1]=complexTemp,k=0;for(c=0;c<complexNextLength;c+=cellDim)for(i=0;i<cellDim;i++){for(j=0;j<cellDim;j++)i!=j&&(complexTemp[k]=complexNext[c+j],k++);i&1&&(exchange1=k-2,exchange2=k-1,complexTemp[exchange1]^=complexTemp[exchange2],complexTemp[exchange2]^=complexTemp[exchange1],complexTemp[exchange1]^=complexTemp[exchange2])}}this.complexes=complexes},simplexn.Topology.prototype.__defineGetter__("dim",function(){return this.complexes.length-1}),simplexn.Topology.prototype.__defineGetter__("maxCells",function(){return this.complexes[this.dim]}),simplexn.Topology.prototype.equals=function(other){var complexes1=this.complexes,complexes2=other.complexes,dim1=this.dim,dim2=other.dim,i;if(dim1!==dim2)return!1;for(i=0;i<dim1;i+=1)if(!_areEqual(complexes1[i],complexes2[i]))return!1;return!0},simplexn.Topology.prototype.remap=function(mapping){var length,i;return this.complexes.forEach(function(complex){length=complex.length;for(var i=0;i<length;i+=1)complex[i]=mapping[complex[i]]}),this},simplexn.Topology.prototype.invert=function(){var dim=this.dim,complex=this.complexes[dim],length=complex.length,cellSize=dim+1,cells=[],cell,swap,i,j;for(i=0;i<length;i+=cellSize){cell=[];for(j=0;j<cellSize;j+=1)cell.push(complex[i+j]);swap=cell[0],cell[0]=cell[dim],cell[dim]=swap,cells.push(cell)}this._computeTopology(cells)},simplexn.Topology.prototype.clone=function(){var clone=new Topology,dim=this.dim,complexes=new Array,i;return this.complexes.forEach(function(complex,i){complexes[i]=new Uint32Array(complex)}),clone.complexes=complexes,clone},simplexn.Topology.prototype.cells0d=function(){if(this.dim===0)return this.complexes[0];var complexes=this.complexes||[[]],cells1d=complexes[1]||[],length=cells1d.length,cells0d=new Uint32Array(length),i,j,k=0,found;for(i=0;i<length;i+=1){found=!1;for(j=0;j<k&&!found;j+=1)found|=cells1d[i]===cells0d[j];found||(cells0d[k++]=[cells1d[i]])}return cells0d.subarray(0,k)},simplexn.Topology.prototype.skeleton=function(ord){var dim=this.dim,ord=ord===undefined?dim-1:ord,out=dim-ord;if(ord===0)this.complexes=[this.cells0d()];else while(out--)this.complexes.pop();return this},simplexn.Topology.prototype.boundary=function(){var dim=this.dim-1;this.skeleton(dim);var complexes=this.complexes,cellLength=dim+1,cells=complexes[dim],cellsLength=cells.length,cellsSize=cellsLength/cellLength,sortedCells=new Uint32Array(cells),notBoundaryCells=new Uint8Array(cellsSize),boundary,boundarySize=cellsSize,cell,equal,i,j,b,c;for(i=0;i<cellsLength;i+=cellLength)_quickSort(sortedCells.subarray(i,i+cellLength));for(c=0;c<cellsSize;c+=1){cell=sortedCells.subarray(c*cellLength,c*cellLength+cellLength);if(!notBoundaryCells[c])for(i=c+1;i<cellsSize;i+=1){equal=!0;for(j=0;j<cellLength&&equal;j+=1)equal&=sortedCells[i*cellLength+j]===cell[j];notBoundaryCells[c]|=equal,notBoundaryCells[i]|=equal}}for(c=0;c<cellsSize;c+=1)boundarySize-=notBoundaryCells[c];boundary=new Uint32Array(boundarySize*cellLength);for(c=0,b=0;c<cellsSize;c+=1)if(!notBoundaryCells[c])for(i=0;i<cellLength;i+=1)boundary[b++]=cells[c*cellLength+i];return this._computeTopology(boundary,dim),this};var SimplicialComplex=simplexn.SimplicialComplex=function(points,complex){var points=points||[[]],complex=complex||[[]];this.pointset=new PointSet(points),this.topology=new Topology(complex)};simplexn.SimplicialComplex.prototype.__defineGetter__("rn",function(){return this.pointset.rn}),simplexn.SimplicialComplex.prototype.__defineGetter__("size",function(){return this.pointset.size}),simplexn.SimplicialComplex.prototype.__defineGetter__("dim",function(){return this.topology.dim}),simplexn.SimplicialComplex.prototype.rotate=function(dims,angle){return this.pointset.rotate(dims,angle),this},simplexn.SimplicialComplex.prototype.scale=function(dims,values){var invert;return this.pointset.scale(dims,values),invert=values.reduce(function(v1,v2){return v1*v2}),invert<0&&this.topology.invert(),this},simplexn.SimplicialComplex.prototype.translate=function(dims,values){return this.pointset.translate(dims,values),this},simplexn.SimplicialComplex.prototype.transform=function(matrix){return this.pointset.transform(matrix),this},simplexn.SimplicialComplex.prototype.embed=function(dim){return this.pointset.embed(dim),this},simplexn.SimplicialComplex.prototype.merge=function(precision){var precision=precision||1e-4,mapping=this.pointset.merge(precision);return this.topology.remap(mapping),this},simplexn.SimplicialComplex.prototype.clone=function(){var clone=new SimplicialComplex;return clone.pointset=this.pointset.clone(),clone.topology=this.topology.clone(),clone},simplexn.SimplicialComplex.prototype.map=function(mapping,merge){var precision=typeof merge=="boolean"?undefined:merge;return this.pointset.map(mapping),merge&&this.merge(precision),this},simplexn.SimplicialComplex.prototype.equals=function(simpcomp){var pointset1=this.pointset,pointset2=simpcomp.pointset,topology1=this.topology,topology2=simpcomp.topology;return pointset1.equals(pointset2)?topology1.equals(topology2)?!0:!1:!1},simplexn.SimplicialComplex.prototype.extrude=function(hlist){var hlist=hlist||[1],hlistLength=hlist.length,hlist0=hlist[0],hlist0isNegative=hlist0<0,positiveQuotes=hlist.filter(function(h){return h>=0}).length,oldRn=this.rn,newRn=oldRn+1,pointset=this.pointset,pointsetSize=pointset.size,oldEmbeddedPoints,oldPointsLength=pointsetSize*oldRn,newPointsLength=pointsetSize*newRn,newPoints=new Float32Array(newPointsLength),newPointsetSize=(hlistLength+1-hlist0isNegative)*pointsetSize,newPointset=new PointSet(newPointsetSize,newRn),oldDim=this.dim,newDim=oldDim+1,topology=this.topology,cellLength=oldDim+1,complex=topology.complexes[oldDim],complexLength=complex.length,complexSize=complexLength/cellLength,newCellLength=newDim+1,newComplexLength=positiveQuotes*complexSize*newDim*newCellLength,newComplex=new Uint32Array(newComplexLength),tempLength=2*cellLength,temp=new Uint32Array(tempLength),tempIndx,cIndx=0,exchange1,exchange2,end,quote=0,h,v,c,i,j;for(i=0;i<complexLength;i+=cellLength)_quickSort(complex.subarray(i,i+cellLength));this.embed(),oldEmbeddedPoints=this.pointset.points,newPoints.set(oldEmbeddedPoints),hlist0isNegative||newPointset.set(oldEmbeddedPoints);for(h=0;h<hlistLength;h+=1){quote+=abs(hlist[h]);for(v=newRn-1;v<newPointsLength;v+=newRn)newPoints[v]=quote;newPointset.set(newPoints,(h+1-hlist0isNegative)*pointsetSize);if(hlist[h]>=0)for(c=0;c<complexSize;c+=1){for(i=0;i<cellLength;i++)tempIndx=complex[c*cellLength+i]+(h-hlist0isNegative)*pointsetSize,temp[i]=tempIndx,temp[i+cellLength]=tempIndx+pointsetSize;for(i=0;i<cellLength;i+=1){end=i+cellLength+1;for(j=i;j<end;j++)newComplex[cIndx++]=temp[j];(newDim&1)*c+(oldDim&1)*i&1&&(exchange1=cIndx-1,exchange2=exchange1-1,_swap(newComplex,exchange1,exchange2))}}}return this.pointset=newPointset,this.topology=new Topology(newComplex,newDim),this},simplexn.SimplicialComplex.prototype.getFacet=function(dim,index){var topology=this.topology,pointset=this.pointset,cells=this.topology.complexes[dim],size=dim+1,start=size*index,cell=cells.subarray(start,start+size),facet=[],i;for(i=0;i<size;i+=1)facet.push(pointset.get(cell[i]));return facet},simplexn.SimplicialComplex.prototype.centroids=function(dim){var dim=dim||this.dim,cellSize=dim+1,cellsSize=this.topology.complexes[dim].length/cellSize,centroids=new PointSet(cellsSize,this.rn),i,centroid;for(i=0;i<cellsSize;i+=1)centroid=vectorAvg(this.getFacet(dim,i)),centroids.set(centroid,i);return centroids},simplexn.SimplicialComplex.prototype.explode=function(values){var dim=this.dim,values=values||[],cell,cellSize=dim+1,cells=this.topology.complexes[dim],cellsSize=cells.length/cellSize,newCell,newCells=[],pointset=this.pointset,newPointset=new PointSet(cellsSize*cellSize,this.rn),centroids=this.centroids(),centroid,translatedCentroid,translationVect,c,i,indx=0;for(c=0;c<cellsSize;c+=1){cell=cells.subarray(c*cellSize,c*cellSize+cellSize),newCell=[],centroid=centroids.get(c),translatedCentroid=vectorMul(centroid,values),translationVect=vectorSub(translatedCentroid,centroid);for(i=0;i<cellSize;i+=1)newCell.push(indx),newPointset.set(vectorAdd(pointset.get(cell[i]),translationVect),indx),indx++;newCells.push(newCell)}return this.pointset=newPointset,this.topology=new Topology(newCells),this.merge()},simplexn.SimplicialComplex.prototype.skeleton=function(dim){return this.topology.skeleton(dim),this},simplexn.SimplicialComplex.prototype.boundary=function(){return this.topology.boundary(),this},simplexn.SimplicialComplex.prototype.prod=function(simpcomp){if(this.rn>1&&simpcomp.rn>2)return;if(this.rn>2&&simpcomp.rn>1)return;var n=simpcomp.size-1,pointset=this.pointset.clone().prod(simpcomp.pointset),quotes=[];while(n--)quotes.push(1);return this.extrude(quotes),this.pointset=pointset,this};var Struct=simplexn.Struct=function(items){var items=items||[],complexes=[],structs=[];items.forEach(function(item){item instanceof SimplicialComplex?complexes.push(item):item instanceof Struct&&structs.push(item)}),this.complexes=complexes,this.structs=structs};simplexn.Struct.prototype.rotate=function(dims,angle){return this.complexes.forEach(function(complex){complex.rotate(dims,angle)}),this.structs.forEach(function(struct){struct.rotate(dims,angle)}),this},simplexn.Struct.prototype.scale=function(dims,values){return this.complexes.forEach(function(complex){complex.scale(dims,values)}),this.structs.forEach(function(struct){struct.scale(dims,values)}),this},simplexn.Struct.prototype.translate=function(dims,values){return this.complexes.forEach(function(complex){complex.translate(dims,values)}),this.structs.forEach(function(struct){struct.translate(dims,values)}),this},simplexn.SimplicialComplex.prototype.clone=function(){var clone=new SimplicialComplex;return clone.pointset=this.pointset.clone(),clone.topology=this.topology.clone(),clone},simplexn.geometries={};var simplex=simplexn.geometries.simplex=function(d){var d=d!==undefined?d+1:1,dim=d,points0=[],points=[],cells=[];while(d--)points0.push(0),cells.unshift(d);return points=matrixIdentity(dim),points.unshift(points0),new SimplicialComplex(points,[cells])},polyline=simplexn.geometries.polyline=function(points){var points=points||[[]],n=points.length-1,cells=[],i;for(i=0;i<n;i+=1)cells.push([i,i+1]);return(new SimplicialComplex(points,cells)).merge()},polypoint=simplexn.geometries.polypoint=function(points){var points=points||[[]],cells=points.map(function(p,i){return[i]});return new SimplicialComplex(points,cells)},simplexGrid=simplexn.geometries.simplexGrid=function(quotesList){var quotesList=quotesList?quotesList.slice(0):[[]],quotesListHead=quotesList.shift(),quotesListHead0=quotesListHead[0],quotesListHead0isNeg=quotesListHead0<=0,points=quotesListHead0isNeg?[]:[[0]],length=quotesList.length,complex=[],simpcomp,quote=0,indx;return quotesListHead.forEach(function(height,i){quote+=abs(height),points.push([quote]),height>0&&(indx=i-quotesListHead0isNeg,complex.push([indx,indx+1]))}),simpcomp=new SimplicialComplex(points,complex),quotesList.forEach(function(quotes){simpcomp.extrude(quotes)}),simpcomp};simplexn.geometries.cuboid=function(sides){return sides=sides.map(function(s){return[s]}),simplexGrid(sides)};var intervals=simplexn.geometries.intervals=function(tip,n){var values=[],value=tip/n;while(n--)values.push(value);return simplexGrid([values])},domain=simplexn.geometries.domain=function(ends,ns){var ends=ends||[0,2*Math.PI],ns=ns||[36],length=ends.length,endsn=ends[0],begin=endsn[0],end=endsn[1],domain=intervals(end-begin,ns[0]).translate([0],[begin]),values,value,i,n;for(i=1;i<length;i+=1){endsn=ends[i],begin=endsn[0],end=endsn[1],n=ns[i],values=[],value=(end-begin)/n;while(n--)values.push(value);domain=domain.extrude(values).translate([i],[begin])}return domain};simplexn.geometries.cube=function(d){var d=d||1,quotes=[];while(d--)quotes.push([1]);return simplexGrid(quotes)},simplexn.geometries.circle=function(radius,n){var r=radius||1,n=n||32,domain=intervals(2*pi,n);return domain.map(function(v){return[r*sin(v[0]),r*cos(v[0])]},!0),domain},simplexn.geometries.disk=function(radius,n,m){var radius=radius||1,n=n||32,m=m||1,nQuote=2*pi/n,mQuote=radius/m,nQuotes=[],mQuotes=[],domain;while(n--)nQuotes.push(nQuote);while(m--)mQuotes.push(mQuote);return domain=simplexGrid([nQuotes,mQuotes]),domain.map(function(coords){var u=coords[0],v=coords[1];return[v*sin(u),v*cos(u)]},!0),domain},simplexn.geometries.cylinderSurface=function(r,h,n,m){var r=r||1,h=h||1,n=n||16,m=m||2,domain=simplexGrid([_repeat(2*pi/n,n),_repeat(1/m,m)]);return domain.map(function(v){return[r*cos(v[0]),r*sin(v[0]),h*v[1]]},!0),domain};var cilinderSolid=simplexn.geometries.cylinderSolid=function(R,r,h,n,m,p){var R=R||1,r=r||0,h=h||1,n=n||16,m=m||1,p=p||1,domain=simplexGrid([_repeat(2*pi/n,n),_repeat((R-r)/m,m),_repeat(h/p,p)]);return domain.translate([1],[r]).map(function(v){return[v[1]*sin(v[0]),v[1]*cos(v[0]),v[2]]},!0),domain},torusSurface=simplexn.geometries.torusSurface=function(r,R,n,m){var r=r||.5,R=R||1.5,n=n||12,m=m||8,domain=simplexGrid([_repeat(2*pi/n,n),_repeat(2*pi/m,m)]);return domain.map(function(v){return[(R+r*cos(v[1]))*cos(v[0]),(R+r*cos(v[1]))*sin(v[0]),r*sin(v[1])]},!0),domain},torusSolid=simplexn.geometries.torusSolid=function(r,R,n,m,p){var r=r||1,R=R||3,n=n||12,m=m||8,p=p||2,domain=simplexGrid([_repeat(2*pi/n,n),_repeat(2*pi/m,m),_repeat(1/pi,p)]);return domain.map(function(v){return[(R+r*v[2]*cos(v[0]))*cos(v[1]),(R+r*v[2]*cos(v[0]))*-sin(v[1]),r*v[2]*sin(v[0])]},!0),domain},triangleStrip=simplexn.geometries.triangleStrip=function(points){var n=points.length,cells=[],i;for(i=2;i<n;i+=1)cells.length&1?cells.push([i-1,i-2,i-0]):cells.push([i-2,i-1,i-0]);return new SimplicialComplex(points,cells)},triangleFan=simplexn.geometries.triangleFan=function(points){var n=points.length,cells=[],i;for(i=2;i<n;i+=1)cells.push([0,i-1,i]);return new SimplicialComplex(points,cells)},helix=simplexn.geometries.helix=function(r,pitch,n,turns){var r=r||1,pitch=pitch||1,n=n||24,turns=turns||8,domain=intervals(2*pi*turns,n*turns);return domain.map(function(v){return[r*sin(v[0]),r*cos(v[0]),pitch/(2*pi)*v[0]]},!0),domain}}(this),!function(exports){var ƒ=exports.ƒ=exports.f={};ƒ.version="0.6.5",ƒ.choose=function(pair){var n=pair[0],k=pair[1],coeff=1,i;for(i=n-k+1;i<=n;i++)coeff*=i;for(i=1;i<=k;i++)coeff/=i;return coeff},ƒ.sel=function(index){return function(array){return array[index]}},ƒ.s0=ƒ.sel(0),ƒ.s1=ƒ.sel(1),ƒ.s2=ƒ.sel(2),ƒ.s3=ƒ.sel(3),ƒ.s4=ƒ.sel(4),ƒ.s5=ƒ.sel(5),ƒ.s6=ƒ.sel(6),ƒ.s7=ƒ.sel(7),ƒ.s8=ƒ.sel(8),ƒ.s9=ƒ.sel(9),ƒ.apply=function(pair){var f=pair[0],x=pair[1];return f(x)},ƒ.aa=function(f){return function(array){return array.map(function(element){return f(element)})}},ƒ.comp2=function(functions){var f=functions[0],g=functions[1];return function(x){return f(g(x))}},ƒ.comp=function(functions){return functions.reduce(function(f,g){return function(x){return f(g(x))}})},ƒ.cons=function(functions){return function(x){return functions.map(function(f){return f(x)})}},ƒ.id=function(value){return value},ƒ.k=function(value){return function(){return value}},ƒ.cat=function(arrays){var result=[];return arrays.forEach(function(array){result=result.concat(array)}),result},ƒ.distl=function(pair){var value=pair[0],array=pair[1];return array.map(function(item){return[value,item]})},ƒ.distr=function(pair){var array=pair[0],value=pair[1];return array.map(function(item){return[item,value]})},ƒ.insl=function(operator){return function(array){return array.reduce(operator)}},ƒ.insr=function(operator){return function(array){return array.reduceRight(operator)}},ƒ.al=function(pair){var item=pair[0],array=pair[1];return[item].concat(array)},ƒ.ar=function(pair){var array=pair[0],item=pair[1];return array.concat([item])},ƒ.last=function(array){return array[array.length-1]},ƒ.list=function(arg){return[arg]},ƒ.len=function(array){return array.length},ƒ.first=function(array){return array[0]},ƒ.reverse=function(array){var result=[],i;for(i=array.length-1;i>=0;i--)result.push(array[i]);return result},ƒ.tail=function(array){return array.slice(1)},ƒ.butlast=function(array){return array.slice(0,-1)},ƒ.repeat=function(n){return function(value){var result=[],i;for(i=0;i<n;i++)result.push(value);return result}},ƒ.replica=function(n){return function(value){var result=[],i;for(i=0;i<n;i++)result=result.concat(value);return result}},ƒ.bigger=function(pair){var a=pair[0],b=pair[1];return a>b?a:b},ƒ.smaller=function(pair){var a=pair[0],b=pair[1];return a<b?a:b},ƒ.biggest=function(values){return Math.max.apply(null,values)},ƒ.smallest=function(values){return Math.min.apply(null,values)},ƒ.sum=function(values){return values[0]instanceof Array?values.reduce(function(prev,curr){return prev.map(function(value,i){return value+curr[i]})}):values.reduce(function(prev,curr){return prev+curr})},ƒ.sub=function(values){return values[0]instanceof Array?values.reduce(function(prev,curr){return prev.map(function(value,i){return value-curr[i]})}):values.reduce(function(prev,curr){return prev-curr})},ƒ.mul=function(values){return values[0]instanceof Array?values.reduce(function(prev,curr){return prev.map(function(value,i){return value*curr[i]})}):values.reduce(function(prev,curr){return prev*curr})},ƒ.div=function(values){return values[0]instanceof Array?values.reduce(function(prev,curr){return prev.map(function(value,i){return value/curr[i]})}):values.reduce(function(prev,curr){return prev/curr})},ƒ.cart=function(args){return args.reduce(function(a,b){var ret=[];return a.forEach(function(a){b.forEach(function(b){ret.push(a.concat([b]))})}),ret},[[]])},ƒ.E=Math.E,ƒ.LN2=Math.LN2,ƒ.LN10=Math.LN10,ƒ.LOG2E=Math.LOG2E,ƒ.LOG10E=Math.LOG10E,ƒ.PI=Math.PI,ƒ.SQRT1_2=Math.SQRT1_2,ƒ.SQRT2=Math.SQRT2,ƒ.abs=Math.abs,ƒ.acos=Math.acos,ƒ.asin=Math.asin,ƒ.atan=Math.atan,ƒ.atan2=Math.atan2,ƒ.ceil=Math.ceil,ƒ.cos=Math.cos,ƒ.exp=Math.exp,ƒ.floor=Math.floor,ƒ.log=Math.log,ƒ.floor=Math.floor,ƒ.pow=function(pair){return Math.pow.apply(null,pair)},ƒ.random=Math.random,ƒ.round=Math.round,ƒ.sin=Math.sin;var sqrt=ƒ.sqrt=Math.sqrt;ƒ.tan=Math.tan,ƒ.trans=function(matrix){var result=[];return matrix.forEach(function(row,i){row.forEach(function(value,j){(result[j]=result[j]||[])[i]=value})}),result},ƒ.prod=function(pair){var scalar=pair[0],vector=pair[1],result=vector.map(function(value){return scalar*value});return result},ƒ.innerprod=function(pair){var v1=pair[0],v2=pair[1],result=0;return v1.forEach(function(value,i){result+=value*v2[i]}),result};var vectnorm=ƒ.vectnorm=function(vector){return sqrt(vector.reduce(function(prev,current){return prev+current*current},0))},unitvect=ƒ.unitvect=function(vector){var norm=vectnorm(vector),result=vector.map(function(value){return value/norm});return result},matsum=ƒ.matsum=function(pair){var m1=pair[0],m2=pair[1],result=[];return m1.forEach(function(row,i){result[i]=[],row.forEach(function(value,j){result[i][j]=value+m2[i][j]})}),result},matprod=ƒ.matprod=function(pair){var m1=pair[0],m2=pair[1],n=m1.length,m=m1[0].length,i,j,k,result=[];for(i=0;i<n;i+=1){result[i]=[];for(j=0;j<m;j+=1)result[i][j]=0}for(i=0;i<n;i+=1)for(j=0;j<m;j+=1)for(k=0;k<m;k+=1)result[i][j]+=m1[i][k]*m2[k][j];return result},identity=ƒ.identity=function(n){var result=[],i;for(i=0;i<n;i+=1){result[i]=[];for(j=0;j<n;j+=1)result[i][j]=i===j?1:0}return result},vectprod=ƒ.vectprod=function(pair){var u=pair[0],v=pair[1],result=[];return result[0]=u[1]*v[2]-u[2]*v[1],result[1]=u[2]*v[0]-u[0]*v[2],result[2]=u[0]*v[1]-u[1]*v[0],result},mat=ƒ.mat=function(dims){var n=dims[0],m=dims[1];return function(vector){var result=[],i;for(i=0;i<n;i+=1)result[i]=vector.slice(i*m,i*m+m);return result}}}(this),!function(exports){var toString={}.toString,max=Math.max,min=Math.min,abs=Math.abs,abs=Math.abs,plasm=exports.plasm={};plasm.version="0.1.9";var Plasm=exports.Plasm=plasm.Viewer=function(container,inspector){if(!(this instanceof plasm.Viewer))return new plasm.Viewer(container);typeof container=="string"&&(container=document.getElementById(container)),typeof inspector=="string"&&(inspector=document.getElementById(inspector));var scene=this.scene=new plasm.Scene,camera=this.camera=new plasm.Camera;scene.add(camera);var controls=this.controls=new plasm.Controls(camera,scene),light=this.light=new THREE.AmbientLight(15658734);scene.root.add(light);var axes=this.axes();axes.draw();var engine=Detector.webgl?THREE.WebGLRenderer:THREE.CanvasRenderer,renderer=this.renderer=new engine({antialias:!0});renderer.setClearColorHex(15724527,1),renderer.setSize(window.innerWidth,window.innerHeight),this.container=container,this.container.appendChild(this.renderer.domElement);if(inspector){var stats=this.stats=new Stats;inspector.appendChild(stats.domElement)}function animate(){requestAnimationFrame(animate),controls.update(),renderer.render(scene.root,camera.optics),inspector&&stats.update()}function resize(){camera.optics.aspect=window.innerWidth/window.innerHeight,camera.optics.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}window.addEventListener("resize",resize,!1),console.log("Plasm.js"),animate()};plasm.Scene=function(){this.root=new THREE.Scene},plasm.Scene.prototype.add=function(object){return object instanceof plasm.Camera?(this.root.add(object.optics),this):object instanceof plasm.Model?(this.root.add(object.mesh),this):this},plasm.Scene.prototype.remove=function(object){return object instanceof plasm.Camera?(this.root.remove(object.optics),this):object instanceof plasm.Model?(this.root.remove(object.mesh),this):this},plasm.Scene.prototype.getBoundingRadius=function(){var radius=0,geometry,position,maxPos;return THREE.SceneUtils.traverseHierarchy(this.root,function(obj){obj instanceof THREE.Object3D&&obj.geometry&&obj.geometry.vertices.length&&(geometry=obj.geometry,geometry.computeBoundingSphere(),position=obj.position,maxPos=max(abs(position.x),abs(position.y),abs(position.z)),radius=max(radius,geometry.boundingSphere.radius+maxPos))}),radius},plasm.Scene.prototype.getCentroid=function(){var centroid=new THREE.Vector3,geometry,position,bbox,p={max:new THREE.Vector3,min:new THREE.Vector3};return THREE.SceneUtils.traverseHierarchy(this.root,function(obj){obj instanceof THREE.Object3D&&obj.geometry&&obj.geometry.vertices.length&&(geometry=obj.geometry,geometry.computeBoundingBox(),bbox=geometry.boundingBox,p.max.x=max(p.max.x,bbox.max.x),p.max.y=max(p.max.y,bbox.max.y),p.max.z=max(p.max.z,bbox.max.z),p.min.x=min(p.min.x,bbox.min.x),p.min.y=min(p.min.y,bbox.min.y),p.min.z=min(p.min.z,bbox.min.z))}),centroid.add(p.max,p.min).divideScalar(2)},plasm.Camera=function(options){if(!(this instanceof plasm.Camera))return new plasm.Camera(options);var options=options||{},fovy=options.fovy||60,aspect=options.aspect||window.innerWidth/window.innerHeight,near=options.near||.1,far=options.far||1e4,optics,controls;optics=new THREE.PerspectiveCamera(fovy,aspect,near,far),optics.fovy=fovy,optics.aspect=aspect,optics.near=near,optics.far=far,optics.position.x=5,optics.position.y=5,optics.position.z=5,this.optics=optics},plasm.Controls=function(camera,scene,options){if(!(this instanceof plasm.Controls))return new plasm.Controls(camera,scene,options);var options=options||{},controls;controls=new THREE.EnhancedTrackballLightControls(camera.optics,scene),controls.rotateSpeed=options.rotateSpeed||5,controls.zoomSpeed=options.zoomSpeed||1.2,controls.panSpeed=options.panSpeed||.8,controls.noZoom=options.noZoom||!1,controls.noPan=options.noPan||!1,controls.dynamicDampingFactor=options.dynamicDampingFactor||.1,this.controls=controls},plasm.Controls.prototype.update=function(){return this.controls.update(),this},plasm.materials={},plasm.materials.PointMaterial=function(){return new THREE.ParticleBasicMaterial({color:0,size:.2})},plasm.materials.LineMaterial=function(){return new THREE.LineBasicMaterial({color:2697513,opacity:1,linewidth:2})},plasm.materials.MeshMaterial=function(){return new THREE.MeshLambertMaterial({color:14145495,wireframe:!Detector.webgl,shading:THREE.FlatShading,vertexColors:THREE.FaceColors})},plasm.materials.cloneColor=function(materialFrom,materialTo){var color=materialFrom.color;materialTo.color.setRGB(color.r,color.g,color.b),materialTo.opacity=materialFrom.opacity!==undefined?materialFrom.opacity:1,materialTo.transparent=materialFrom.transparent!==undefined?materialFrom.transparent:!1},exports.DRAW_SINGLE_SIDE=!1,plasm.Model=function(complex,viewer){if(!(this instanceof plasm.Model))return new plasm.Model(complex,viewer);var complex=complex||new simplexn.SimplicialComplex,pointset=complex.pointset,topology=complex.topology,dim=topology.dim,cells,n_cells,i_cell,v1,v2,v3,geometry=new THREE.Geometry,material,mesh;if(dim<=0){cells=topology.cells0d(),n_cells=cells.length;for(i_cell=0;i_cell<n_cells;i_cell+=1)v1=pointset.get(cells[i_cell]),geometry.vertices.push(new THREE.Vertex(new THREE.Vector3(v1[0]||0,v1[1]||0,v1[2]||0)));material=new plasm.materials.PointMaterial,mesh=new THREE.ParticleSystem(geometry,material)}if(dim===1){cells=topology.complexes[1],n_cells=cells.length;for(i_cell=0;i_cell<n_cells
;i_cell+=2)v1=pointset.get(cells[i_cell+0]),v2=pointset.get(cells[i_cell+1]),geometry.vertices.push(new THREE.Vertex(new THREE.Vector3(v1[0],v1[1],v1[2]))),geometry.vertices.push(new THREE.Vertex(new THREE.Vector3(v2[0],v2[1],v2[2])));material=new plasm.materials.LineMaterial,mesh=new THREE.Line(geometry,material,THREE.LinePieces)}if(dim>=2){cells=topology.complexes[2],n_cells=cells.length,pointset.forEach(function(v){geometry.vertices.push(new THREE.Vertex(new THREE.Vector3(v[0]||0,v[1]||0,v[2]||0)))});for(i_cell=0;i_cell<n_cells;i_cell+=3)geometry.faces.push(new THREE.Face3(cells[i_cell+0],cells[i_cell+1],cells[i_cell+2])),exports.DRAW_SINGLE_SIDE||geometry.faces.push(new THREE.Face3(cells[i_cell+2],cells[i_cell+1],cells[i_cell+0]));geometry.computeCentroids(),geometry.mergeVertices(),geometry.computeFaceNormals(),material=new plasm.materials.MeshMaterial,mesh=new THREE.Mesh(geometry,material)}this.complex=complex,this.geometry=geometry,this.geometry.dynamic=!0,this.material=material,this.mesh=mesh,this.mesh.matrixAutoUpdate=!0,this.mesh.doubleSided=exports.DRAW_SINGLE_SIDE?!0:!1,this.viewer=viewer},plasm.Model.prototype.clone=function(){var model=new plasm.Model(this.complex.clone(),this.viewer);return plasm.materials.cloneColor(this.material,model.material),model},plasm.Model.prototype.draw=function(){return this.mesh.parent!==this.viewer.scene&&this.viewer.scene.add(this),this},plasm.Model.prototype.erase=function(){this.viewer.scene.remove(this),this.complex=null,this.geometry=null,this.mesh=null},plasm.Model.prototype.show=function(){return this.mesh.visible=!0,this},plasm.Model.prototype.hide=function(){return this.mesh.visible=!1,this},plasm.Model.prototype.cancel=function(){return this.mesh.parent.remove(this.mesh),this},plasm.Model.prototype.translate=function(dims,values){var v=[];return this.complex.translate(dims,values),this.complex.rn<=3&&(dims.forEach(function(dim,i){v[dim]=values[i]}),this.mesh.position.addSelf({x:v[0]||0,y:v[1]||0,z:v[2]||0}),this.geometry.__dirtyVertices=!0),this},plasm.Model.prototype.rotate=function(dims,angle){var v=[],axis=3-(dims[0]+dims[1]),angle=angle[0]||angle;return this.complex.rotate(dims,angle),this.complex.rn<=3&&(v[axis]=angle,this.mesh.rotation.addSelf({x:v[0]||0,y:v[1]||0,z:v[2]||0}),this.geometry.__dirtyVertices=!0),this},plasm.Model.prototype.scale=function(dims,values){var v=[];return this.complex.scale(dims,values),this.complex.rn<=3&&(dims.forEach(function(dim,i){v[dim]=values[i]}),this.mesh.scale.multiplySelf({x:v[0]||1,y:v[1]||1,z:v[2]||1}),this.geometry.__dirtyVertices=!0),this},plasm.Model.prototype.map=function(mapping,merge){if(mapping instanceof Array)return this.map(function(v){return mapping.map(function(f){return f(v)})},merge);var complex=this.complex.clone().map(mapping,merge),model=new plasm.Model(complex,this.viewer);return model},plasm.Model.prototype.color=function(rgba){var a=rgba[3];return this.material.color.setRGB(rgba[0]||0,rgba[1]||0,rgba[2]||0),a<1&&(this.material.opacity=a,this.material.transparent=!0),this},plasm.Model.prototype.boundary=function(){var complex=this.complex.clone().boundary(),boundary=new plasm.Model(complex,this.viewer);return plasm.materials.cloneColor(this.material,boundary.material),boundary},plasm.Model.prototype.skeleton=function(dim){var complex=this.complex.clone().skeleton(dim),skeleton=new plasm.Model(complex,this.viewer);return plasm.materials.cloneColor(this.material,skeleton.material),skeleton},plasm.Model.prototype.extrude=function(hlist){var complex=this.complex.clone().extrude(hlist),extrusion=new plasm.Model(complex,this.viewer);return plasm.materials.cloneColor(this.material,extrusion.material),extrusion},plasm.Model.prototype.explode=function(values){var complex=this.complex.clone().explode(values),explosion=new plasm.Model(complex,this.viewer);return plasm.materials.cloneColor(this.material,explosion.material),explosion},plasm.Model.prototype._prod=function(model){var complex=this.complex.clone().prod(model.complex),result=new plasm.Model(complex,this.viewer);return plasm.materials.cloneColor(this.material,result.material),result},plasm.Model.prototype.prod1x1=function(model){if(this.complex.rn!==1||model.complex.rn!==1)throw"Dimesion error.";return this._prod(model)},plasm.Model.prototype.prod1x2=function(model){if(this.complex.rn!==1||model.complex.rn!==2)throw"Dimesion error.";return this._prod(model)},plasm.Model.prototype.prod2x1=function(model){if(this.complex.rn!==2||model.complex.rn!==1)throw"Dimesion error.";return this._prod(model)},plasm.Struct=function(items){if(!(this instanceof plasm.Struct))return new plasm.Struct(items);var items=items||[],structs=[],models=[],model;items.forEach(function(item){model=item.clone(),model instanceof plasm.Model?models.push(model):model instanceof plasm.Struct&&structs.push(model)}),this.structs=structs,this.models=models},plasm.Struct.prototype.clone=function(){var cloned=new plasm.Struct,models=[],structs=[];return this.models.forEach(function(model){models.push(model.clone())}),this.structs.forEach(function(struct){structs.push(struct.clone())}),cloned.models=models,cloned.structs=structs,cloned},plasm.Struct.prototype.draw=function(){return this.models.forEach(function(model){model.draw()}),this.structs.forEach(function(struct){struct.draw()}),this},plasm.Struct.prototype.cancel=function(){return this.models.forEach(function(model){model.cancel()}),this.structs.forEach(function(struct){struct.cancel()}),this},plasm.Struct.prototype.erase=function(){this.viewer.scene.remove(this),this.structs=null,this.models=null},plasm.Struct.prototype.show=function(){return this.models.forEach(function(model){model.show()}),this.structs.forEach(function(struct){struct.show()}),this},plasm.Struct.prototype.hide=function(){return this.models.forEach(function(model){model.hide()}),this.structs.forEach(function(struct){struct.hide()}),this},plasm.Struct.prototype.add=function(item){if(this===item)return this;var model=item.clone();return model instanceof plasm.Model?this.models.push(model):model instanceof Struct&&this.structs.push(model.complex),this},plasm.Struct.prototype.remove=function(item){if(this===item)return this;var index,array;return item instanceof plasm.Model?array=this.models:item instanceof Struct&&(array=this.structs),index=array.indexOf(item),index>0&&(array.splice(index,1),item.remove()),this},plasm.Struct.prototype.translate=function(dims,values){return this.models.forEach(function(model){model.translate(dims,values)}),this.structs.forEach(function(struct){struct.translate(dims,values)}),this},plasm.Struct.prototype.rotate=function(dims,angle){return this.models.forEach(function(model){model.rotate(dims,angle)}),this.structs.forEach(function(struct){struct.rotate(dims,angle)}),this},plasm.Struct.prototype.scale=function(dims,values){return this.models.forEach(function(model){model.scale(dims,values)}),this.structs.forEach(function(struct){struct.scale(dims,values)}),this},plasm.Struct.prototype.color=function(rgba){return this.models.forEach(function(model){model.color(rgba)}),this.structs.forEach(function(struct){struct.color(rgba)}),this},plasm.Struct.prototype.extrude=function(hlist){var struct=new plasm.Struct;return this.models.forEach(function(model){struct.models.push(model.extrude(hlist))}),this.structs.forEach(function(struct){struct.structs.push(struct.extrude(hlist))}),struct},plasm.Viewer.prototype.simplicialComplex=function(points,complex){var complex=new simplexn.SimplicialComplex(points,complex),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.simplex=function(d){var complex=new simplexn.geometries.simplex(d),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.polyline=function(points){var complex=simplexn.geometries.polyline(points),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.polypoint=function(points){var complex=simplexn.geometries.polypoint(points),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.axes=function(){var axeX=new simplexn.SimplicialComplex([[0,0,0],[1,0,0]],[[0,1]]),axeY=new simplexn.SimplicialComplex([[0,0,0],[0,1,0]],[[0,1]]),axeZ=new simplexn.SimplicialComplex([[0,0,0],[0,0,1]],[[0,1]]),modelX=(new plasm.Model(axeX,this)).color([1,0,0]),modelY=(new plasm.Model(axeY,this)).color([0,1,0]),modelZ=(new plasm.Model(axeZ,this)).color([0,0,1]),axes=new plasm.Struct([modelX,modelY,modelZ]);return axes},plasm.Viewer.prototype.simplexGrid=function(quotesList){var complex=new simplexn.geometries.simplexGrid(quotesList),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.cuboid=function(sides){var complex=new simplexn.geometries.cuboid(sides),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.intervals=function(tip,n){var complex=new simplexn.geometries.intervals(tip,n),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.domain=function(tips,ns){var domain=new simplexn.geometries.domain(tips,ns),model=new plasm.Model(domain,this);return model},plasm.Viewer.prototype.cube=function(d){var complex=new simplexn.geometries.cube(d),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.circle=function(radius,n){var complex=new simplexn.geometries.circle(radius,n),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.disk=function(radius,n,m){var complex=new simplexn.geometries.disk(radius,n,m),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.cylinderSurface=function(r,h,n,m){var complex=new simplexn.geometries.cylinderSurface(r,h,n,m),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.torusSurface=function(r_min,r_max,n,m){var complex=new simplexn.geometries.torusSurface(r_min,r_max,n,m),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.torusSolid=function(r_min,r_max,n,m,p){var r_min=r_min||1,r_max=r_max||3,n=n||12,m=m||8,p=p||8,complex=new simplexn.geometries.torusSolid(r_min,r_max,n,m,p),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.triangleStrip=function(points){var complex=new simplexn.geometries.triangleStrip(points),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.triangleFan=function(points){var complex=new simplexn.geometries.triangleFan(points),model=new plasm.Model(complex,this);return model},plasm.Viewer.prototype.helix=function(r,pitch,n,turns){var complex=new simplexn.geometries.helix(r,pitch,n,turns),model=new plasm.Model(complex,this);return model}}(this),!function(exports){var fun=exports.fun={};Object.keys(ƒ).forEach(function(key){fun[key.toUpperCase()]=ƒ[key]}),fun.version="0.1.9";var p;fun.PLASM=function(viewer){p=viewer,fun.globalize()},fun.globalize=function(){fun.globalize=function(){},Object.keys(fun).forEach(function(key){exports[key]=fun[key]})},fun.DRAW=function(object){if(object instanceof plasm.Model||object instanceof plasm.Struct)return object.draw();return},fun.CANCEL=function(object){if(object instanceof plasm.Model||object instanceof plasm.Struct)return object.cancel();return};var R=fun.R=fun.ROTATE=function(dims){return function(angle){return function(object){return object.clone().rotate(dims,angle)}}},S=fun.S=fun.SCALE=function(dims){return function(values){return function(object){return object.clone().scale(dims,values)}}},T=fun.T=fun.TRANSLATE=function(dims){return function(values){return function(object){return object.clone().translate(dims,values)}}};fun.STRUCT=function(items){var transformations=function(o){return o},objects=[];return temp=[],items.forEach(function(item){item instanceof plasm.Model||item instanceof plasm.Struct?(temp.push(APPLY([transformations,item]).clone()),objects.push(APPLY([transformations,item]))):transformations=COMP2([transformations,item])}),new plasm.Struct(objects,p)},fun.MAP=function(mapping){return function(domain){return domain.map(mapping)}};var EXTRUDE=fun.EXTRUDE=function(hlist){return function(object){return object.extrude(hlist)}},EXPLODE=fun.EXPLODE=function(values){return function(model){return model.explode(values)}},SKELETON=fun.SKELETON=function(dim){return function(model){return model.skeleton(dim)}},BOUNDARY=fun.BOUNDARY=function(model){return model.boundary()},COLOR=fun.COLOR=function(rgba){return function(object){return object.clone().color(rgba)}},SHOW=fun.SHOW=function(object){object.show()},HIDE=fun.HIDE=function(object){object.hide()},SIMPLICIAL_COMPLEX=fun.SIMPLICIAL_COMPLEX=function(points){return function(cells){return p.simplicialComplex(points,cells)}},SIMPLEX=fun.SIMPLEX=function(d){return p.simplex(d)},POLYLINE;fun.POLYLINE=function(points){return p.polyline(points)};var POLYPOINT;fun.POLYPOINT=function(points){return p.polypoint(points)};var SIMPLEX_GRID=fun.SIMPLEX_GRID=function(quotes){return p.simplexGrid(quotes)},CUBE=fun.CUBE=function(d){return p.cube(d)},CUBOID=fun.CUBOID=function(sides){return p.cuboid(sides)},INTERVALS=fun.INTERVALS=function(tip){return function(n){return p.intervals(tip,n)}},DOMAIN=fun.DOMAIN=function(ends){return function(ns){return p.domain(ends,ns)}},PROD1x1=fun.PROD1x1=function(array){return array[0].prod1x1(array[1])},PROD1x2=fun.PROD1x2=function(array){return array[0].prod1x2(array[1])},PROD2x1=fun.PROD2x1=function(array){return array[0].prod2x1(array[1])},CIRCLE=fun.CIRCLE=function(r){var r=r||1;return function(n){return p.circle(r,n)}},DISK=fun.DISK=function(r){var r=r||1;return function(divs){var divs=divs||[],slices=divs[0]||24,stacks=divs[1]||3;return p.disk(r,slices,stacks)}},CYL_SURFACE=fun.CYL_SURFACE=function(dims){var dims=dims||[],r=dims[0]||1,h=dims[1]||1;return function(divs){var divs=divs||[],slices=divs[0]||12,stacks=divs[1]||8;return p.cylinderSurface(r,h,slices,stacks)}},TORUS_SURFACE=fun.TORUS_SURFACE=function(dims){var dims=dims||[],r_min=dims[0]||1,r_max=dims[1]||1.9;return function(divs){var divs=divs||[],n=divs[0]||12,m=divs[1]||12;return p.torusSurface(r_min,r_max,n,m)}},TORUS_SOLID=fun.TORUS_SOLID=function(dims){var dims=dims||[],r_min=dims[0]||.1,r_max=dims[1]||.9;return function(divs){var divs=divs||[],n=divs[0]||12,m=divs[1]||8,q=divs[2]||8;return p.torusSolid(r_min,r_max,n,m,q)}},TRIANGLE_STRIP=fun.TRIANGLE_STRIP=function(points){return p.triangleStrip(points)},TRIANGLE_FAN=fun.TRIANGLE_FAN=function(points){return p.triangleFan(points)},HELIX=fun.HELIX=function(r,pitch,n,turns){return p.helix(r,pitch,n,turns)},CUBIC_HERMIT=fun.CUBIC_HERMITE=function(sel){return function(args){var p1Fn=args[0],p2Fn=args[1],s1Fn=args[2],s2Fn=args[3];return function(point){var u=sel(point),u2=u*u,u3=u2*u,p1=p1Fn instanceof Function?p1Fn(point):p1Fn,p2=p2Fn instanceof Function?p2Fn(point):p2Fn,s1=s1Fn instanceof Function?s1Fn(point):s1Fn,s2=s2Fn instanceof Function?s2Fn(point):s2Fn,rn=p1.length,mapped=new Array(rn),i;for(i=0;i<rn;i+=1)mapped[i]=(2*u3-3*u2+1)*p1[i]+(-2*u3+3*u2)*p2[i]+(u3-2*u2+u)*s1[i]+(u3-u2)*s2[i];return mapped}}},BEZIER=fun.BEZIER=function(sel){return function(args){var n=args.length-1,controldataFn=args;return function(point){var t=sel(point),controldata=new Array(n+1),mapped,rn,weight,crtldata,i,k;for(i=0;i<=n;i+=1)crtldata=controldataFn[i],controldata[i]=crtldata instanceof Function?crtldata(point):crtldata;rn=controldata[0].length,mapped=new Array(rn);for(i=0;i<rn;i+=1)mapped[i]=0;for(i=0;i<=n;i+=1){weight=CHOOSE([n,i])*POW([1-t,n-i])*POW([t,i]);for(k=0;k<rn;k+=1)mapped[k]+=weight*controldata[i][k]}return mapped}}},CUBIC_UBSPLINE=fun.CUBIC_UBSPLINE=function(domain){return function(args){var q1Fn=args[0],q2Fn=args[1],q3Fn=args[2],q4Fn=args[3];return MAP(function(point){var u=S0(point),u2=u*u,u3=u2*u,rn,mapped,i,q1=q1Fn instanceof Function?q1Fn(point):q1Fn,q2=q2Fn instanceof Function?q2Fn(point):q2Fn,q3=q3Fn instanceof Function?q3Fn(point):q3Fn,q4=q4Fn instanceof Function?q4Fn(point):q4Fn;rn=q1.length,mapped=new Array(rn);for(i=0;i<rn;i+=1)mapped[i]=1/6*((-u3+3*u2-3*u+1)*q1[i]+(3*u3-6*u2+4)*q2[i]+(-3*u3+3*u2+3*u+1)*q3[i]+u3*q4[i]);return mapped})(domain)}},CUBIC_CARDINAL=fun.CUBIC_CARDINAL=function(domain,h){var h=h!==undefined?h:1;return function(args){var q1Fn=args[0],q2Fn=args[1],q3Fn=args[2],q4Fn=args[3];return MAP(function(point){var u=S0(point),u2=u*u,u3=u2*u,rn,mapped,i,q1=q1Fn instanceof Function?q1Fn(point):q1Fn,q2=q2Fn instanceof Function?q2Fn(point):q2Fn,q3=q3Fn instanceof Function?q3Fn(point):q3Fn,q4=q4Fn instanceof Function?q4Fn(point):q4Fn;rn=q1.length,mapped=new Array(rn);for(i=0;i<rn;i+=1)mapped[i]=(-h*u3+2*h*u2-h*u)*q1[i]+((2-h)*u3+(h-3)*u2+1)*q2[i]+((h-2)*u3+(3-2*h)*u2+h*u)*q3[i]+(h*u3-h*u2)*q4[i];return mapped})(domain)}},SPLINE=fun.SPLINE=function(curve){return function(points){var segments=[],length=points.length,tip=length-4+1,slice,i;for(i=0;i<tip;i+=1)slice=points.slice(i,i+4),segments.push(curve(slice));return STRUCT(segments)}},DE_BOORD=function(T,i,k,t,n){var tmin=T[k-1],tmax=T[n+1],ret,num1,div1,num2,div2;return k===1?t>=T[i]&&t<T[i+1]||t===tmax&&t>=T[i]&&t<=T[i+1]?1:0:(ret=0,num1=t-T[i],div1=T[i+k-1]-T[i],div1!==0&&(ret+=num1/div1*DE_BOORD(T,i,k-1,t,n)),num2=T[i+k]-t,div2=T[i+k]-T[i+1],div2!==0&&(ret+=num2/div2*DE_BOORD(T,i+1,k-1,t,n)),ret)},BSPLINE=fun.BSPLINE=function(degree){return function(knots){return function(controls){var n=controls.length-1,m=knots.length-1,k=degree+1;if(knots.length!==n+k+1)throw"Invalid point/knots/degree for bspline!";return function(point){var t=point[0],points=new Array(n),rn,control,mapped,coeff,i,j;for(i=0;i<=n;i+=1)control=controls[i],points[i]=control instanceof Function?control(point):control;rn=points[0].length,mapped=new Array(rn);for(i=0;i<rn;i+=1)mapped[i]=0;for(i=0;i<=n;i+=1){coeff=DE_BOORD(knots,i,k,t,n);for(j=0;j<rn;j+=1)mapped[j]+=points[i][j]*coeff}return mapped}}}},NUBSPLINE=fun.NUBSPLINE=function(degree,totpoints){var totpoints=totpoints!==undefined?totpoints:80;return function(knots){return function(points){var m=knots.length,tmin=SMALLEST(knots),tmax=BIGGEST(knots),tsiz=tmax-tmin,size=totpoints-1,v=new Array(size+1),domain,i;v[0]=-tmin;for(i=1;i<=size;i+=1)v[i]=tsiz/size;return domain=SIMPLEX_GRID([v]),MAP(BSPLINE(degree)(knots)(points))(domain)}}},NUBS=fun.NUBS=function(sel){return function(degree){return function(knots){return function(controls){var n=controls.length-1,knotsLength=knots.length,k=degree+1;if(knots.length!==n+k+1)throw"Invalid point/knots/degree for bspline!";return function(point){var t=sel(point),points=new Array(n),kmin=SMALLEST(knots),kmax=BIGGEST(knots),ksize=kmax-kmin,mappedKnots=new Array(knotsLength),rn,control,mapped,coeff,i,j;mappedKnots=knots.map(function(knot){return(knot-kmin)/ksize});for(i=0;i<=n;i+=1)control=controls[i],points[i]=control instanceof Function?control(point):control;rn=points[0].length,mapped=new Array(rn);for(i=0;i<rn;i+=1)mapped[i]=0;for(i=0;i<=n;i+=1){coeff=DE_BOORD(mappedKnots,i,k,t,n);for(j=0;j<rn;j+=1)mapped[j]+=points[i][j]*coeff}return mapped}}}}},RATIONAL_BSPLINE=fun.RATIONAL_BSPLINE=function(degree){return function(knots){return function(controls){var bspline=BSPLINE(degree)(knots)(controls);return function(point){var mapped=bspline(point),last=mapped.slice(-1)[0];return last!==0&&(mapped=mapped.map(function(item){return item/last})),mapped.slice(0,-1)}}}},NURBSPLINE=fun.NURBSPLINE=function(degree,totpoints){var totpoints=totpoints!==undefined?totpoints:80;return function(knots){return function(points){var m=knots.length,tmin=SMALLEST(knots),tmax=BIGGEST(knots),tsiz=tmax-tmin,size=totpoints-1,v=new Array(size+1),domain,i;v[0]=-tmin;for(i=1;i<=size;i+=1)v[i]=tsiz/size;return domain=SIMPLEX_GRID([v]),MAP(RATIONAL_BSPLINE(degree)(knots)(points))(domain)}}},ROTATIONAL_SURFACE=fun.ROTATIONAL_SURFACE=function(profile){return function(point){var u=point[0],v=point[1],p=profile(point),f=p[0],h=p[1],g=p[2],ret=[f*COS(v),f*SIN(v),g];return ret}},COONS_PATCH=fun.COONS_PATCH=function(args){var su0Fn=args[0],su1Fn=args[1],s0vFn=args[2],s1vFn=args[3];return function(point){u=point[0],v=point[1];var s00=su0Fn([0,0]),s01=s0vFn([0,1]),s10=su0Fn([1,0]),s11=s1vFn([1,1]),su0=su0Fn(point),su1=su1Fn(point),s0v=s0vFn(point),s1v=s1vFn(point),rn=su0.length,mapped=new Array(rn),i;for(i=0;i<rn;i+=1)mapped[i]=(1-u)*s0v[i]+u*s1v[i]+(1-v)*su0[i]+v*su1[i]-(1-u)*(1-v)*s00[i]-(1-u)*v*s01[i]-u*(1-v)*s10[i]-u*v*s11[i];return mapped}},PROFILEPROD_SURFACE=fun.PROFILEPROD_SURFACE=function(profiles){var alfaProfile=profiles[0],betaSection=profiles[1];return function(point){var pAlfa=alfaProfile(point),sBeta=betaSection(point),xA=pAlfa[0],zA=pAlfa[2],xB=sBeta[0],yB=sBeta[1],ret=[xA*xB,xA*yB,zA];return ret}}}(this);